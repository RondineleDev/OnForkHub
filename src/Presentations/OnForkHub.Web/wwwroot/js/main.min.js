var H = Object.defineProperty;
var M = (e, o, t) => o in e ? H(e, o, { enumerable: !0, configurable: !0, writable: !0, value: t }) : e[o] = t;
var h = (e, o, t) => M(e, typeof o != "symbol" ? o + "" : o, t);
function $(e) {
  console.log("setupCounter - Iniciando com elemento:", e);
  let o = 0;
  const t = (d) => {
    o = d, e.innerHTML = `count is ${o}`, console.log("Counter atualizado para:", o);
  };
  e.addEventListener("click", () => {
    console.log("Clique detectado - valor atual:", o), t(o + 1);
  }), t(0);
}
function q(e) {
  const o = parseInt(e.innerHTML.replace("count is ", ""), 10) || 0;
  e.innerHTML = `count is ${o + 1}`, console.log("Counter incrementado para:", o + 1);
}
function I() {
  console.log("Hello, World - from JS");
}
const y = /* @__PURE__ */ new WeakMap();
class E {
  constructor(o) {
    h(this, "element");
    h(this, "count");
    this.element = o, this.count = 0, this.init();
  }
  init() {
    this.updateDisplay(), this.element.addEventListener("click", () => this.increment());
  }
  increment() {
    this.count++, this.updateDisplay(), console.log("Exemplo incrementado para:", this.count);
  }
  updateDisplay() {
    this.element.innerHTML = `Exemplo count: ${this.count}`;
  }
}
function U(e) {
  const o = new E(e);
  return y.set(e, o), o;
}
function z(e) {
  let o = y.get(e);
  o || (o = new E(e), y.set(e, o)), o.increment();
}
let b = null, l = null, T = !1, s = null;
function v(e) {
  if (!e || !(e instanceof HTMLElement))
    throw new Error("Element is not an HTMLElement");
}
function L() {
  if (s) {
    try {
      const e = s.src;
      s.pause(), s.src = "", s.load(), e.startsWith("blob:") && URL.revokeObjectURL(e);
    } catch (e) {
      console.warn("Error cleaning up video element:", e);
    }
    s = null;
  }
}
function x() {
  return `
        <div class="w-100 h-100 d-flex flex-column align-items-center justify-content-center">
            <div class="loading-status text-white mb-3">Initializing...</div>
            <div class="progress w-75">
                <div class="progress-bar" role="progressbar" style="width: 0%"></div>
            </div>
        </div>
    `;
}
function S() {
  const e = document.createElement("video");
  return e.style.display = "none", e.className = "w-100 h-100", e.style.objectFit = "contain", e.playsInline = !0, e.controls = !0, e.preload = "auto", e;
}
async function k() {
  if (!document.querySelector('script[src*="webtorrent"]'))
    return new Promise((e, o) => {
      const t = document.createElement("script");
      t.src = "", t.async = !0, t.onload = () => {
        console.log("WebTorrent script loaded"), e();
      }, t.onerror = (d) => {
        console.error("Failed to load WebTorrent script:", d), o(new Error("Failed to load WebTorrent script"));
      }, document.head.appendChild(t);
    });
}
async function C() {
  if (!T)
    if (await k(), window.WebTorrent)
      console.log("Creating WebTorrent client..."), b = new window.WebTorrent(), T = !0, console.log("WebTorrent client created");
    else
      throw new Error("WebTorrent not loaded");
}
async function F(e) {
  try {
    e.innerHTML = "Initializing WebTorrent...", await C(), e.innerHTML = "WebTorrent initialized";
  } catch (o) {
    const t = o instanceof Error ? o.message : "Unknown error";
    throw e.innerHTML = `Error: ${t}`, o;
  }
}
async function V(e, o, t) {
  return console.log("Starting download..."), L(), b || (console.log("Client not initialized, setting up..."), await C()), l && (console.log("Destroying existing torrent..."), l.destroy(), l = null), new Promise((d, w) => {
    try {
      const r = document.querySelector(o);
      if (!r)
        throw new Error(`Container element not found: ${o}`);
      r.innerHTML = x();
      const u = r.querySelector(".loading-status"), p = r.querySelector(".progress-bar");
      u && v(u), p && v(p);
      const W = {
        announce: [
          "wss://tracker.openwebtorrent.com",
          "wss://tracker.webtorrent.dev"
        ],
        maxWebConns: 4,
        strategy: "sequential"
      };
      b.add(t, W, (i) => {
        console.log("Torrent added, searching for video file..."), l = i;
        const f = i.files.find((n) => {
          const a = n.name.endsWith(".mp4") || n.name.endsWith(".webm") || n.name.endsWith(".mkv");
          return console.log("Checking file:", n.name, "isVideo:", a), a;
        });
        if (!f)
          throw new Error("No video file found in torrent");
        console.log("Video file found:", f.name);
        const c = S();
        s = c, r.appendChild(c), f.getBlobURL((n, a) => {
          if (n) {
            console.error("Error getting blob URL:", n), w(n);
            return;
          }
          console.log("Got blob URL, setting up video..."), c.src = a, c.style.display = "block";
          const g = r.querySelector(".d-flex");
          g && r.removeChild(g), c.addEventListener("loadedmetadata", () => {
            console.log("Video metadata loaded"), i.progress > 0.1 && c.play().catch((m) => {
              console.warn("Could not auto-start video:", m);
            });
          });
        }), i.on("download", () => {
          const n = (i.progress * 100).toFixed(1), a = (i.downloadSpeed / (1024 * 1024)).toFixed(2), g = `Progress: ${n}% (${a} MB/s)`;
          u && (u.textContent = `Loading: ${n}%`), p && (p.style.width = `${n}%`), e.innerHTML = g, i.progress > 0.1 && s && s.paused && s.play().catch((m) => {
            console.warn("Could not start video:", m);
          });
        }), i.on("done", () => {
          console.log("Download complete"), e.innerHTML = "Download complete", d();
        }), i.on("error", (n) => {
          console.error("Torrent error:", n), w(n);
        }), i.on("warning", (n) => {
          n.message.includes("tracker") || console.warn("Torrent warning:", n);
        });
      });
    } catch (r) {
      console.error("Error in startDownload:", r), w(r);
    }
  });
}
function R() {
  console.log("Stopping download..."), L(), l && (l.destroy(), l = null);
  const e = document.querySelector("#videoContainer");
  e && (e.innerHTML = ""), console.log("Download stopped, resources cleaned up");
}
export {
  $ as Counter,
  U as Exemplo,
  I as HelloWorld,
  q as incrementCounter,
  z as incrementExemplo,
  F as initTorrentPlayer,
  V as startDownload,
  R as stopDownload
};
